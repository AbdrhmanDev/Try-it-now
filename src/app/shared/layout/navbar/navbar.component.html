<nav
  class="navbar mb-2 top-0 w-full z-50 transition-all duration-300"
  [class.scrolled]="isScrolled()"
  [class.menu-open]="isMenuOpen()"
>
  <div
    class="navbar-container flex hover:text-blue-600 items-center justify-between px-6 py-4"
  >
    <!-- Logo -->
    <a
      routerLink="/"
      class="logo flex items-center gap-2 text-xl font-bold text-white"
      (click)="closeMenu()"
    >
      <i class="fas fa-rocket text-yellow-400"></i>
      <span>AngularApp</span>
    </a>

    <!-- Desktop Links & Auth (shown on medium+ screens) -->
    <!-- Desktop Links -->
    <!-- Desktop Nav -->
    <div class="hidden md:flex items-center space-x-8 relative">
      @for (item of navItems(); track item.path) { @if (item.isMegaMenu) {
      <!-- Services with Mega Menu -->
      <div class="relative" (click)="toggleMegaMenu(true)">
        <a
          type="button"
          class="text-gray-700 hover:text-blue-600 font-medium transition-colors duration-200 flex items-center gap-1 bg-transparent border-none cursor-pointer p-0"
          (click)="toggleMegaMenu(!isMegaMenuOpen())"
          [attr.aria-expanded]="isMegaMenuOpen()"
          aria-haspopup="true"
        >
          {{ item.label }}
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-4 w-4"
            viewBox="0 0 20 20"
            fill="currentColor"
          >
            <path
              fill-rule="evenodd"
              d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
              clip-rule="evenodd"
            />
          </svg>
        </a>

        <!-- Mega Menu Dropdown -->
        <div
          *ngIf="isMegaMenuOpen()"
          id="mega-menu-full-dropdown"
          class="absolute left-0 mt-2 w-screen max-w-4xl px-4 py-5 mx-auto bg-white border-y border-gray-200 shadow-lg dark:bg-gray-800 dark:border-gray-600 rounded-lg"
          (mouseenter)="toggleMegaMenu(true)"
          (mouseleave)="toggleMegaMenu(false)"
        >
          <div class="grid max-w-screen-xl grid-cols-1 sm:grid-cols-2 md:px-6">
            @for (column of megaMenuContent; track column.title) {
            <ul class="p-2">
              <li class="font-semibold text-gray-800 dark:text-gray-100 mb-2">
                {{ column.title }}
              </li>
              @for (link of column.links; track link.path) {
              <li>
                <a
                  [routerLink]="link.path"
                  (click)="closeMenu()"
                  class="block p-3 rounded-lg text-sm text-gray-600 hover:bg-gray-50 dark:text-gray-300 dark:hover:bg-gray-700"
                >
                  <div class="font-medium">{{ link.label }}</div>
                  <div class="text-gray-500 dark:text-gray-400">Learn more</div>
                </a>
              </li>
              }
            </ul>
            }
          </div>
        </div>
      </div>
      } @else {
      <!-- Regular Link -->
      <a
        [routerLink]="item.path"
        routerLinkActive="active"
        [routerLinkActiveOptions]="{ exact: true }"
        class="text-gray-700 hover:text-blue-600 font-medium transition-colors duration-200"
        (click)="closeMenu()"
      >
        {{ item.label }}
      </a>
      } }

      <!-- Auth Buttons -->
      <button
        class="px-4 py-2 border border-gray-400 text-gray-700 rounded hover:bg-gray-100"
        routerLink="/login"
        *ngIf="!AuthService.isLoggedIn()"
      >
        Login
      </button>
      <button
        class="px-4 py-2 border border-gray-400 text-gray-700 rounded hover:bg-gray-100"
        routerLink="/login"
        *ngIf="AuthService.isLoggedIn()"
        (click)="AuthService.logout()"
      >
        logout
      </button>
      <button
        class="px-4 py-2 bg-blue-600 text-white font-semibold rounded hover:bg-blue-700"
        *ngIf="!AuthService.isLoggedIn()"
      >
        Sign Up
      </button>
    </div>

    <!-- Mobile Menu Button -->
    <button
      class="md:hidden flex flex-col"
      [class.active]="isMenuOpen()"
      (click)="toggleMenu()"
      aria-label="Toggle menu"
    >
      <span class="w-6 h-0.5 bg-white mb-1"></span>
      <span class="w-6 h-0.5 bg-white mb-1"></span>
      <span class="w-6 h-0.5 bg-white"></span>
    </button>
  </div>

  <!-- Mobile Menu Overlay -->
  <div
    class="mobile-menu-overlay fixed inset-0 bg-black/80 z-40"
    [class.active]="isMenuOpen()"
    (click)="closeMenu()"
  >
    <div class="mobile-menu bg-gray-900 p-6 w-4/5 max-w-sm h-full text-white">
      <ul class="mobile-nav-links space-y-6 mt-8">
        @for (item of navItems(); track item.path) {
        <li class="mobile-nav-item">
          @if (item.isMegaMenu && isMobile()) {
          <!-- Mobile Mega Menu Trigger -->
          <button
            type="button"
            class="mobile-nav-link block text-xl w-full text-left"
            (click)="toggleMobileMega(); $event.stopPropagation()"
          >
            {{ item.label }}
            <span
              class="float-right transition-transform"
              [class.rotate-180]="isMobileMegaOpen()"
            >
              â–¼
            </span>
          </button>

          <!-- Mobile Mega Menu Content (Accordion) -->
          @if (isMobileMegaOpen()) {
          <div class="mt-4 ml-4 border-l-2 border-blue-500 pl-4 space-y-3">
            @for (column of megaMenuContent; track column.title) {
            <div>
              <h4 class="font-semibold text-blue-300 mb-2">
                {{ column.title }}
              </h4>
              @for (link of column.links; track link.path) {
              <a
                [routerLink]="link.path"
                (click)="closeMenu()"
                class="block py-2 text-gray-300 hover:text-white hover:bg-gray-800 rounded"
              >
                {{ link.label }}
              </a>
              }
            </div>
            }
          </div>
          } } @else {
          <!-- Regular Link -->
          <a
            [routerLink]="item.path"
            routerLinkActive="active"
            class="mobile-nav-link block text-xl"
            (click)="closeMenu()"
          >
            {{ item.label }}
          </a>
          }
        </li>
        }
      </ul>

      <div class="mobile-auth mt-10 space-y-4">
        <button
          class="btn mobile-btn btn-login w-full py-3 bg-transparent border border-white text-white rounded mobile-btn"
          routerLink="/login"
          (click)="closeMenu()"
        >
          Login
        </button>
        <button
          class="btn btn-signup mobile-btn w-full py-3 bg-yellow-500 text-gray-900 font-semibold rounded mobile-btn"
          routerLink="/signup"
          (click)="closeMenu()"
        >
          Sign Up
        </button>
      </div>
    </div>
  </div>
</nav>
